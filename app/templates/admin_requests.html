<!DOCTYPE html>
<html>
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
        <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
        <title>Admin-Swap Requests - tukar-je</title>
    </head>
    <body>
        <header class="header">
          <div class="logo">
            <img src="{{ url_for('static', filename='images/Multimedia_University_logo.png')}}" alt="MMU Logo">
            <img src="{{url_for('static', filename='images/tukar_logo.png') }}" alt="Tukar Logo">
        </div>
        <nav class="navbar">
          <a href="{{ url_for('main.index') }}">Home</a>
          <a href="{{ url_for('main.dashboard') }}">Dashboard</a> 
          <a href="{{ url_for('main.logout') }}">Logout</a> 
          <a href="{{ url_for('main.notification') }}"><button type="button" class="icon-button">
          <span class="material-icons">notifications</span>
          </button></a>
      </nav>
            
        </header>
        <div class="adminrequests-container">
        <div class="section">
            <h2>Swap Requests</h2>
        </div>
        <div class="nav-wrapper">
            <div class="nav-icon" onclick="toggleSidebar()"><span class="material-icons">menu</span>
            
            </div>
            <nav class="sidebar" id="sidebar">
              <ul>
                <li><a href="{{ url_for('main.dashboard') }}">Dashboard</a></li>
                <li><a href="{{ url_for('main.swap_requests') }}">Requests</a></li>
                <li><a href="#">Students</a></li>
                <li><a href="#">Settings</a></li>
              </ul>
            </nav>
          </div>

          <div class="table-controls">
            <form id="filter-form" method="GET" action="/admin/requests" style="display: flex; gap: 1rem;">
            <!-- Search Bar -->
            <div class="search-container">
                <input id="search-input" type="text" name="search" placeholder="Search..." value="{{ search }}"  >
                <span class="material-icons" id="search-icon">search</span>
            </div>
          
            <!-- Status Filter -->
            <div class="filter-container">

              <select id="status-filter" name="status" onchange="document.getElementById('filter-form').submit()">
                <option value="all" {% if status == 'all' %}selected{% endif %}>Filter Status</option>
                <option value="pending" {% if status == 'pending'%}selected{% endif %} >Pending</option>
                <option value="approved" {% if status == 'approved' %}selected{% endif %}   >Approved</option>
                <option value="rejected" {% if status == 'rejected' %}selected{% endif %}>Rejected</option>
              </select>
            </div>

            <!-- Sort dropdown -->
           <select id="sort-select" name="sort" onchange="document.getElementById('filter-form').submit()">
            <option value="">Sort By</option>
            <option value="name_asc" {% if sort == 'name_asc' %}selected{% endif %}>Name (A-Z)</option>
            <option value="name_desc" {% if sort == 'name_desc' %}selected{% endif %}>Name (Z-A)</option>
            <option value="date_new" {% if sort == 'date_new' %}selected{% endif %}>Date (Newest)</option>
            <option value="date_old" {% if sort == 'date_old' %}selected{% endif %}>Date (Oldest)</option>
           </select>
        
            
        </form>
    </div>
         

        <table class="table" border="1">
            <thead>
                <tr>
                    <th>Name</th>
                    <th>Current Hostel</th>
                    <th>Desired Hostel</th>
                    <th>Room Type</th>
                    <th>Status</th>
                    <th>Created At</th>
                    <th>Actions</th>
                </tr>
            </thead>
            <tbody>
                {% for req in requests %}
                <tr>
                    <td>{{ req.name }}</td>
                    <td>{{ req.current }}</td>
                    <td>{{ req.desired }}</td>
                    <td>{{ req.type }}</td>
                    <td class="status">
                        {% if req.status == "pending" %}
                            <span class="status-pending">⏳Pending</span>
                        {% elif req.status == "approved" %}
                            <span class="status-approved">✅ Approved</span>
                        {% else %}
                            <span class="status-rejected">❌ Rejected</span>
                        {% endif %}
                    </td>
                    <td>{{ req.date }}</td>
                    <td class="actions">
                        {% if req.status == 'pending' %}
                            
                        <form method="POST" action="{{ url_for('main.approve_request') }}" style="display:inline;">
                            <input type="hidden" name="id" value="{{ req.id }}">
                            <button type="submit" class="btn-approve" >Approve</button>
                        </form>
                        <form action="{{ url_for('main.reject_request') }}" method="POST" style="display:inline;">
                            <input type="hidden" name="id" value="{{ req.id }}">
                            <button type="submit" class="btn-reject">Reject</button>
                        </form>
                        {% else %}
                <button class="btn-approve" disabled>Approve</button>
                <button class="btn-reject" disabled>Reject</button>
                {% endif %}
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
        <div class="pagination">
            {% if page > 1 %}
              <a href="{{ url_for('main.swap_requests', page=page-1, search=search, status=status, sort=sort) }}">Previous</a>
            {% endif %}
          
            {% for p in range(1, total_pages + 1) %}
              {% if p == page %}
                <span class="current">{{ p }}</span>
              {% else %}
                <a href="{{ url_for('main.swap_requests', page=p, search=search, status=status, sort=sort) }}">{{ p }}</a>
              {% endif %}
            {% endfor %}
          
            {% if page < total_pages %}
              <a href="{{ url_for('main.swap_requests', page=page+1, search=search, status=status, sort=sort) }}">Next</a>
            {% endif %}
          </div>
    </div>

        <footer>
          <div class="footer-col">
              <ul>
              <div class="logo">
              <img src="{{url_for('static', filename='images/tukar_logo.png') }}" alt="Tukar Logo"></div>
                  <li><p>&copy; 2025 Tukar-Je. ALL RIGHTS RESERVED</p></li>
              </ul>
          </div>
          <div class="footer-col">
              <h4>Quick Links</h4>
              <ul>
                  <li><a href="">About</a></li>
                  <li><a href="https://www.mmu.edu.my/accommodation/">Accomodation</a></li>
                  <li><a href="https://online.mmu.edu.my/">Portal</a></li>
              </ul>
          </div>
          <div class="footer-col">
              <h4>Contact Us</h4>
              <ul>
                  <li><a href="#">support@mmu.com</a></li>
              </ul>
          </div> 

      </footer>
      <script>
        function toggleSidebar() {
          const sidebar = document.getElementById('sidebar');
          sidebar.classList.toggle('sidebar-open');
        }
      </script>
      
    </body>
</html>